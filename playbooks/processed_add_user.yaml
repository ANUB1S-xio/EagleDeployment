name: "Basic_Add_Users"
version: "2.1"
hosts:
  - "10.42.56.106"
  - "10.42.56.99"
  - "10.42.56.98"
  - "10.42.56.110"
vars:
  user_name: "demouser"      # Use the passed username from inventory file
  user_password: "DemoPass098"   # Use the passed password from inventory file
tasks:
  - name: "Add user on Linux systems"
    ssh_user: "eagleadmin"
    ssh_password: "@dminPass123"
    port: 22
    when: item.OS | lower in ["linux", "ubuntu"]
    loop: "[{10.42.56.106 node-3-fedora Linux - Fedora Linux 40} {10.42.56.99 node-2-ubuntu Linux - Ubuntu 22.04} {10.42.56.98 node-1-ubuntu Linux - Ubuntu 22.04} {10.42.56.110 node-4-win11 Windows 11 Pro}]"
    loop_control:
      loop_var: item
    command: |
      echo -e "@dminPass123\n" | script -qc 'sudo -S useradd -m -s /bin/bash "demouser"' /dev/null

  - name: "Add user on Fedora systems"
    ssh_user: "eagleadmin"
    ssh_password: "@dminPass123"
    port: 22
    when: item.OS | lower contains "fedora"
    loop: "[{10.42.56.106 node-3-fedora Linux - Fedora Linux 40} {10.42.56.99 node-2-ubuntu Linux - Ubuntu 22.04} {10.42.56.98 node-1-ubuntu Linux - Ubuntu 22.04} {10.42.56.110 node-4-win11 Windows 11 Pro}]"
    loop_control:
      loop_var: item
    command: |
      echo -e "@dminPass123\n" | script -qc 'sudo -S useradd -m -s /bin/bash "demouser"' /dev/null

  - name: "Add user on Windows systems"
    ssh_user: "eagleadmin"
    ssh_password: "@dminPass123"
    port: 22
    when: item.OS | lower contains "windows"
    loop: "[{10.42.56.106 node-3-fedora Linux - Fedora Linux 40} {10.42.56.99 node-2-ubuntu Linux - Ubuntu 22.04} {10.42.56.98 node-1-ubuntu Linux - Ubuntu 22.04} {10.42.56.110 node-4-win11 Windows 11 Pro}]"
    loop_control:
      loop_var: item
    command: |
      net user "demouser" "DemoPass098" /add

  - name: "Set password for user on Linux systems"
    ssh_user: "eagleadmin"
    ssh_password: "@dminPass123"
    port: 22
    when: item.OS | lower in ["linux", "ubuntu", "fedora"]
    loop: "[{10.42.56.106 node-3-fedora Linux - Fedora Linux 40} {10.42.56.99 node-2-ubuntu Linux - Ubuntu 22.04} {10.42.56.98 node-1-ubuntu Linux - Ubuntu 22.04} {10.42.56.110 node-4-win11 Windows 11 Pro}]"
    loop_control:
      loop_var: item
    command: |
      echo -e "@dminPass123\n" | script -qc 'sudo -S bash -c "echo demouser:DemoPass098 | chpasswd"' /dev/null

settings:
  port: 22
