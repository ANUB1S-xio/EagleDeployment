# File: add_user2.yaml

name: "add_user2"
version: "2.1"
#inventory: "inventory.yml"
hosts: []
  #- "192.168.56.101" #ubuntu machine

#vars:
  #new_user: "samwise"
  #new_password: "Pot@toes123"
  #SSH_USER: "{{ lookup('env','SSH_USER') }}"
  #SSH_PASS: "{{ lookup('env','SSH_PASS') }}"

tasks:

  - name: "Add user samwise on Linux systems"
    ssh_user: "eagleadmin"
    ssh_password: "@dminPass123"
    port: 22
    when: os_type.stdout in ["ubuntu", "fedora"]
    command: |
      echo "@dminPass123" | sudo -S useradd -m -s /bin/bash "samwise"

  - name: "Pause to ensure user creation"
    ssh_user: "eagleadmin"
    ssh_password: "@dminPass123"
    port: 22
    command: sleep 2

  - name: "Verify new user exists"
    ssh_user: "eagleadmin"
    ssh_password: "@dminPass123"
    port: 22
    command: |
      echo "@dminPass123" | sudo -S id "samwise"

  - name: "Set password for user samwise on Linux systems"
    ssh_user: "eagleadmin"
    ssh_password: "@dminPass123"
    port: 22
    when: os_type.stdout in ["ubuntu", "fedora"]
    command: |
      echo "@dminPass123" | sudo -S bash -c "echo 'samwise:Pot@toes123' | chpasswd"
settings:
   port: 22